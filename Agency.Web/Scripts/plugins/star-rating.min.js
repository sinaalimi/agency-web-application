/*!
 * @copyright &copy; Kartik Visweswaran, Krajee.com, 2014
 * @version 3.5.0
 *
 * A simple yet powerful JQuery star rating plugin that allows rendering
 * fractional star ratings and supports Right to Left (RTL) input.
 * 
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */
(function(n){var f=0,e=5,i=.5,o="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,t=function(t,i){return typeof t=="undefined"||t===null||t===undefined||t==[]||t===""||i&&n.trim(t)===""},r=function(n,i,r){var u=t(n.data(i))?n.attr(i):n.data(i);return u?u:r[i]},s=function(n){var t=(""+n).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return t?Math.max(0,(t[1]?t[1].length:0)-(t[2]?+t[2]:0)):0},h=function(n,t){return parseFloat(n.toFixed(t))},u=function(t,i){this.$element=n(t);this.init(i)};u.prototype={constructor:u,_parseAttr:function(n,u){var l=this,s=l.$element,h,o,c;return s.attr("type")==="range"||s.attr("type")==="number"?(h=r(s,n,u),o=i,n==="min"?o=f:n==="max"?o=e:n==="step"&&(o=i),c=t(h)?o:h,parseFloat(c)):parseFloat(u[n])},listen:function(){var t=this;t.initTouch();t.$rating.on("click",function(n){if(!t.inactive){var i=n.pageX-t.$rating.offset().left;t.setStars(i);t.$element.trigger("change");t.$element.trigger("rating.change",[t.$element.val(),t.$caption.html()]);t.starClicked=!0}});t.$rating.on("mousemove",function(n){if(t.hoverEnabled&&!t.inactive){t.starClicked=!1;var r=n.pageX-t.$rating.offset().left,i=t.calculate(r);t.toggleHover(i);t.$element.trigger("rating.hover",[i.val,i.caption,"stars"])}});t.$rating.on("mouseleave",function(){if(t.hoverEnabled&&!t.inactive&&!t.starClicked){var n=t.cache;t.toggleHover(n);t.$element.trigger("rating.hoverleave",["stars"])}});t.$clear.on("mousemove",function(){if(t.hoverEnabled&&!t.inactive&&t.hoverOnClear){t.clearClicked=!1;var i='<span class="'+t.clearCaptionClass+'">'+t.clearCaption+"<\/span>",n=t.clearValue,u=t.getWidthFromValue(n),r;r={caption:i,width:u,val:n};t.toggleHover(r);t.$element.trigger("rating.hover",[n,i,"clear"])}});t.$clear.on("mouseleave",function(){if(t.hoverEnabled&&!t.inactive&&!t.clearClicked&&t.hoverOnClear){var n=t.cache;t.toggleHover(n);t.$element.trigger("rating.hoverleave",["clear"])}});t.$clear.on("click",function(){t.inactive||(t.clear(),t.clearClicked=!0)});n(t.$element[0].form).on("reset",function(){t.inactive||t.reset()})},destroy:function(){var i=this,r=i.$element;t(i.$container)||i.$container.before(r).remove();n.removeData(r.get(0));r.off("rating").removeClass("hide")},create:function(){var n=arguments.length>0?arguments[0]:{},t=self.$element;self.destroy();t.rating(n)},setTouch:function(n,t){var i=this;if(o&&!i.inactive){var u=n.originalEvent,s=u.touches.length>0?u.touches:u.changedTouches,f=s[0].pageX-i.$rating.offset().left;if(t===!0)i.setStars(f),i.$element.trigger("change"),i.$element.trigger("rating.change",[i.$element.val(),i.$caption.html()]),i.starClicked=!0;else{var r=i.calculate(f),h=r.val<=i.clearValue?i.fetchCaption(i.clearValue):r.caption,e=i.getWidthFromValue(i.clearValue),c=r.val<=i.clearValue?i.rtl?100-e+"%":e+"%":r.width;i.$caption.html(h);i.$stars.css("width",c)}}},initTouch:function(){var n=this;n.$rating.on("touchstart",function(t){n.setTouch(t,!1)});n.$rating.on("touchmove",function(t){n.setTouch(t,!1)});n.$rating.on("touchend",function(t){n.setTouch(t,!0)})},initSlider:function(n){var r=this;t(r.$element.val())&&r.$element.val(0);r.initialValue=r.$element.val();r.min=typeof n.min!="undefined"?n.min:r._parseAttr("min",n);r.max=typeof n.max!="undefined"?n.max:r._parseAttr("max",n);r.step=typeof n.step!="undefined"?n.step:r._parseAttr("step",n);(isNaN(r.min)||t(r.min))&&(r.min=f);(isNaN(r.max)||t(r.max))&&(r.max=e);(isNaN(r.step)||t(r.step)||r.step==0)&&(r.step=i);r.diff=r.max-r.min},init:function(i){var r=this,e,u,f;r.options=i;r.hoverEnabled=i.hoverEnabled;r.hoverChangeCaption=i.hoverChangeCaption;r.hoverChangeStars=i.hoverChangeStars;r.hoverOnClear=i.hoverOnClear;r.starClicked=!1;r.clearClicked=!1;r.initSlider(i);r.checkDisabled();$element=r.$element;r.containerClass=i.containerClass;r.glyphicon=i.glyphicon;e=r.glyphicon?"":"★";r.symbol=t(i.symbol)?e:i.symbol;r.rtl=i.rtl||r.$element.attr("dir");r.rtl&&r.$element.attr("dir","rtl");r.showClear=i.showClear;r.showCaption=i.showCaption;r.size=i.size;r.stars=i.stars;r.defaultCaption=i.defaultCaption;r.starCaptions=i.starCaptions;r.starCaptionClasses=i.starCaptionClasses;r.clearButton=i.clearButton;r.clearButtonTitle=i.clearButtonTitle;r.clearButtonBaseClass=t(i.clearButtonBaseClass)?"clear-rating":i.clearButtonBaseClass;r.clearButtonActiveClass=t(i.clearButtonActiveClass)?"clear-rating-active":i.clearButtonActiveClass;r.clearCaption=i.clearCaption;r.clearCaptionClass=i.clearCaptionClass;r.clearValue=t(i.clearValue)?r.min:i.clearValue;r.$element.removeClass("form-control").addClass("form-control");r.$clearElement=t(i.clearElement)?null:n(i.clearElement);r.$captionElement=t(i.captionElement)?null:n(i.captionElement);typeof r.$rating=="undefined"&&typeof r.$container=="undefined"&&(r.$rating=n(document.createElement("div")).html('<div class="rating-stars" dir="ltr"><\/div>'),r.$container=n(document.createElement("div")),r.$container.before(r.$rating),r.$container.append(r.$rating),r.$element.before(r.$container).appendTo(r.$rating));r.$stars=r.$rating.find(".rating-stars");r.generateRating();r.$clear=t(r.$clearElement)?r.$container.find("."+r.clearButtonBaseClass):r.$clearElement;r.$caption=t(r.$captionElement)?r.$container.find(".caption"):r.$captionElement;r.setStars();r.$element.removeClass("hide").addClass("hide");r.listen();r.showClear&&r.$clear.attr({"class":r.getClearClass()});u=r.$element.val();f=r.getWidthFromValue(u);r.cache={caption:r.$caption.html(),width:(r.rtl?100-f:f)+"%",val:u};r.$element.removeClass("rating-loading")},checkDisabled:function(){var n=this;n.disabled=r(n.$element,"disabled",n.options);n.readonly=r(n.$element,"readonly",n.options);n.inactive=n.disabled||n.readonly},getClearClass:function(){return this.clearButtonBaseClass+" "+(this.inactive?"":this.clearButtonActiveClass)},generateRating:function(){var n=this,r=n.renderClear(),u=n.renderCaption(),i=n.rtl?"rating-container-rtl":"rating-container",f=n.getStars();i+=n.glyphicon?n.symbol==""?" rating-gly-star":" rating-gly":" rating-uni";n.$rating.attr("class",i);n.$rating.attr("data-content",f);n.$stars.attr("data-content",f);i=n.rtl?"star-rating-rtl":"star-rating";n.$container.attr("class",i+" rating-"+n.size);n.inactive?n.$container.removeClass("rating-active").addClass("rating-disabled"):n.$container.removeClass("rating-disabled").addClass("rating-active");typeof n.$caption=="undefined"&&typeof n.$clear=="undefined"&&(n.rtl?n.$container.prepend(u).append(r):n.$container.prepend(r).append(u));t(n.containerClass)||n.$container.removeClass(n.containerClass).addClass(n.containerClass)},getStars:function(){for(var n=this,r=n.stars,t="",i=1;i<=r;i++)t+=n.symbol;return t},renderClear:function(){var n=this,i;return n.showClear?(i=n.getClearClass(),!t(n.$clearElement))?(n.$clearElement.removeClass(i).addClass(i).attr({title:n.clearButtonTitle}),n.$clearElement.html(n.clearButton),""):'<div class="'+i+'" title="'+n.clearButtonTitle+'">'+n.clearButton+"<\/div>":""},renderCaption:function(){var n=this,r=n.$element.val(),i;return n.showCaption?(i=n.fetchCaption(r),!t(n.$captionElement))?(n.$captionElement.removeClass("caption").addClass("caption").attr({title:n.clearCaption}),n.$captionElement.html(i),""):'<div class="caption">'+i+"<\/div>":""},fetchCaption:function(n){var i=this,r=parseFloat(n),u,f,e;return u=typeof i.starCaptionClasses=="function"?t(i.starCaptionClasses(r))?i.clearCaptionClass:i.starCaptionClasses(r):t(i.starCaptionClasses[r])?i.clearCaptionClass:i.starCaptionClasses[r],f=typeof i.starCaptions=="function"?t(i.starCaptions(r))?i.defaultCaption.replace(/\{rating\}/g,r):i.starCaptions(r):t(i.starCaptions[r])?i.defaultCaption.replace(/\{rating\}/g,r):i.starCaptions[r],e=r==i.clearValue?i.clearCaption:f,'<span class="'+u+'">'+e+"<\/span>"},getWidthFromValue:function(n){var i=this,t=i.min,r=i.max,u=i.step;return n<=t||t==r?0:n>=r?100:(n-t)*100/(r-t)},getValueFromPosition:function(n){var t=this,u=s(t.step),i,r,f=t.$rating.width();return r=t.diff*n/(f*t.step),r=t.rtl?Math.floor(r):Math.ceil(r),i=h(parseFloat(t.min+r*t.step),u),i=Math.max(Math.min(i,t.max),t.min),t.rtl?t.max-i:i},toggleHover:function(n){var t=this,r,i,u;t.hoverChangeCaption&&(r=n.val<=t.clearValue?t.fetchCaption(t.clearValue):n.caption,t.$caption.html(r));t.hoverChangeStars&&(i=t.getWidthFromValue(t.clearValue),u=n.val<=t.clearValue?t.rtl?100-i+"%":i+"%":n.width,t.$stars.css("width",u))},calculate:function(n){var i=this,f=t(i.$element.val())?0:i.$element.val(),u=arguments.length?i.getValueFromPosition(n):f,e=i.fetchCaption(u),r=i.getWidthFromValue(u);return i.rtl&&(r=100-r),r+="%",{caption:e,width:r,val:u}},setStars:function(n){var t=this,i=arguments.length?t.calculate(n):t.calculate();t.$element.val(i.val);t.$stars.css("width",i.width);t.$caption.html(i.caption);t.cache=i},clear:function(){var n=this,t='<span class="'+n.clearCaptionClass+'">'+n.clearCaption+"<\/span>";n.$stars.removeClass("rated");n.inactive||n.$caption.html(t);n.$element.val(n.clearValue);n.setStars();n.$element.trigger("rating.clear")},reset:function(){var n=this;n.$element.val(n.initialValue);n.setStars();n.$element.trigger("rating.reset")},update:function(n){var t=this;arguments.length&&(t.$element.val(n),t.setStars())},refresh:function(t){var i=this;arguments.length&&(i.$rating.off("rating"),i.$clear.off(),i.init(n.extend(i.options,t)),i.showClear?i.$clear.show():i.$clear.hide(),i.showCaption?i.$caption.show():i.$caption.hide(),i.$element.trigger("rating.refresh"))}};n.fn.rating=function(t){var i=Array.apply(null,arguments);return i.shift(),this.each(function(){var f=n(this),r=f.data("rating"),e=typeof t=="object"&&t;r||f.data("rating",r=new u(this,n.extend({},n.fn.rating.defaults,e,n(this).data())));typeof t=="string"&&r[t].apply(r,i)})};n.fn.rating.defaults={stars:5,glyphicon:!0,symbol:null,disabled:!1,readonly:!1,rtl:!1,size:"md",showClear:!0,showCaption:!0,defaultCaption:"{rating} Stars",starCaptions:{.5:"Half Star",1:"One Star",1.5:"One & Half Star",2:"Two Stars",2.5:"Two & Half Stars",3:"Three Stars",3.5:"Three & Half Stars",4:"Four Stars",4.5:"Four & Half Stars",5:"Five Stars"},starCaptionClasses:{.5:"label label-danger",1:"label label-danger",1.5:"label label-warning",2:"label label-warning",2.5:"label label-info",3:"label label-info",3.5:"label label-primary",4:"label label-primary",4.5:"label label-success",5:"label label-success"},clearButton:'<i class="glyphicon glyphicon-minus-sign"><\/i>',clearButtonTitle:"Clear",clearButtonBaseClass:"clear-rating",clearButtonActiveClass:"clear-rating-active",clearCaption:"Not Rated",clearCaptionClass:"label label-default",clearValue:null,captionElement:null,clearElement:null,containerClass:null,hoverEnabled:!0,hoverChangeCaption:!0,hoverChangeStars:!0,hoverOnClear:!0};n("input.rating").addClass("rating-loading");n(document).ready(function(){var t=n("input.rating"),i=Object.keys(t).length;i>0&&t.rating()})})(jQuery);